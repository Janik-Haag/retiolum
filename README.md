# retiolum

retiolum network files.

* `etc.hosts` belongs to `/etc/hosts`
* `hosts` belongs to `/etc/tinc/retiolum/hosts`

For an example config look at `example.nix`


# HOWTO join the network

## generate your public/private keypair

create a new folder somewhere on your machine

```
mkdir retiolum-cfg
```

generate a private key

```
openssl genrsa -out retiolum-cfg/retiolum.rsa_key.priv 4096
```

generate the public key from the private key

```
openssl rsa -in retiolum-cfg/retiolum.rsa_key.priv -pubout -out retiolum-cfg/retiolum.rsa_key.pub
```

## add key to stockholm

```
git clone https://cgit.krebsco.de/stockholm
```

choose an ipv4 address in the range of 10.243.0.0/16
check if the ipv4 address is already used by anyone in stockholm:

```
git -C stockholm grep 10.243.my.ip
```

modify the default.nix in krebs/3modules/external

```
vim krebs/3modules/external/default.nix
```

add your host nix information to this file, please mind the alphabetical sorting

now, create a patch out of your changes:

```
git diff > retiolum.patch
````

## ask for approval

join the #krebs channel on freenode.
If you don't know anything about irc,  you can just use this webirc: https://webchat.freenode.net/#krebs
If you are not known, introduce yourself, explain what you are doing and what you want to contribute. upload your patch to some pastebin (preferably https://paste.krebsco.de) or send it to spam@krebsco.de

## configure your nixos for retiolum

after you have been approved..

check if your pubkey file is in the current master of https://github.com/krebs/retiolum
look into your pubkey file and copy your ipv6 address which got autogenerated.
copy the `example.nix` to your configuration.nix, update the rev and sha256 of the retiolum fetchgit to the current master. (you have to update it everytime if new hosts join you want to connect to)
import the example.nix (you can choose a better name, like retiolum.nix) in your configuration.nix
configure your ipv4 and ipv6 addresses

inside configuration.nix:

```
imports = [
  /path/to/example.nix
];
networking.retiolum.ipv4 = "10.243.my.ip";
networking.retiolum.ipv6 = "42:0:3c35::my:ip";
```

## test if everything is working

ping some host on the network, for example blue.r

```
ping 10.243.0.77
ping 42:0:ce16::b1ce
```
